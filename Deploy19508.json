{"$schema":"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"siteName":{"type":"String"},"hostingPlanName":{"type":"String"},"siteLocation":{"type":"String"},"sku":{"defaultValue":"Free","allowedValues":["Free","Shared","Basic","Standard"],"type":"String"},"workerSize":{"defaultValue":0,"allowedValues":["0","1","2"],"type":"String"}},"resources":[{"type":"Microsoft.Web/serverfarms","name":"[parameters('hostingPlanName')]","apiVersion":"2015-02-01","location":"[parameters('siteLocation')]","properties":{"name":"[parameters('hostingPlanName')]","sku":"[parameters('sku')]","workerSize":"[parameters('workerSize')]","numberOfWorkers":1}},{"type":"Microsoft.Web/sites","name":"[parameters('siteName')]","apiVersion":"2015-02-01","location":"[parameters('siteLocation')]","tags":{"[concat('hidden-related:', resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]":"Resource"},"properties":{"name":"[parameters('siteName')]","serverFarmId":"[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"},"resources":[{"type":"Extensions","name":"MSDeploy","apiVersion":"2015-02-01","properties":{"packageUri":"https://auxmktplceprod.blob.core.windows.net/packages/StarterSite-modified.zip","dbType":"None","connectionString":"","setParameters":{"Application Path":"[parameters('siteName')]"}},"dependsOn":["[concat('Microsoft.Web/Sites/', parameters('siteName'))]"]}],"dependsOn":["[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"]},{"type":"microsoft.insights/autoscalesettings","name":"[concat(parameters('hostingPlanName'), '-', resourceGroup().name)]","apiVersion":"2014-04-01","location":"East US","tags":{"[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]":"Resource"},"properties":{"profiles":[{"name":"Default","capacity":{"minimum":"1","maximum":"2","default":"1"},"rules":[{"metricTrigger":{"metricName":"CpuPercentage","metricResourceUri":"[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]","timeGrain":"PT1M","statistic":"Average","timeWindow":"PT10M","timeAggregation":"Average","operator":"GreaterThan","threshold":80},"scaleAction":{"direction":"Increase","type":"ChangeCount","value":"1","cooldown":"PT10M"}},{"metricTrigger":{"metricName":"CpuPercentage","metricResourceUri":"[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]","timeGrain":"PT1M","statistic":"Average","timeWindow":"PT1H","timeAggregation":"Average","operator":"LessThan","threshold":60},"scaleAction":{"direction":"Decrease","type":"ChangeCount","value":"1","cooldown":"PT1H"}}]}],"enabled":false,"name":"[concat(parameters('hostingPlanName'), '-', resourceGroup().name)]","targetResourceUri":"[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"},"dependsOn":["[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"]},{"type":"microsoft.insights/alertrules","name":"[concat('ServerErrors ', parameters('siteName'))]","apiVersion":"2014-04-01","location":"East US","tags":{"[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/sites/', parameters('siteName'))]":"Resource"},"properties":{"name":"[concat('ServerErrors ', parameters('siteName'))]","description":"[concat(parameters('siteName'), ' has some server errors, status code 5xx.')]","isEnabled":false,"condition":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.ThresholdRuleCondition","dataSource":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.RuleMetricDataSource","resourceUri":"[concat(resourceGroup().id, '/providers/Microsoft.Web/sites/', parameters('siteName'))]","metricName":"Http5xx"},"operator":"GreaterThan","threshold":0,"windowSize":"PT5M"},"action":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.RuleEmailAction","sendToServiceOwners":true,"customEmails":[]}},"dependsOn":["[concat('Microsoft.Web/sites/', parameters('siteName'))]"]},{"type":"microsoft.insights/alertrules","name":"[concat('ForbiddenRequests ', parameters('siteName'))]","apiVersion":"2014-04-01","location":"East US","tags":{"[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/sites/', parameters('siteName'))]":"Resource"},"properties":{"name":"[concat('ForbiddenRequests ', parameters('siteName'))]","description":"[concat(parameters('siteName'), ' has some requests that are forbidden, status code 403.')]","isEnabled":false,"condition":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.ThresholdRuleCondition","dataSource":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.RuleMetricDataSource","resourceUri":"[concat(resourceGroup().id, '/providers/Microsoft.Web/sites/', parameters('siteName'))]","metricName":"Http403"},"operator":"GreaterThan","threshold":0,"windowSize":"PT5M"},"action":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.RuleEmailAction","sendToServiceOwners":true,"customEmails":[]}},"dependsOn":["[concat('Microsoft.Web/sites/', parameters('siteName'))]"]},{"type":"microsoft.insights/alertrules","name":"[concat('CPUHigh ', parameters('hostingPlanName'))]","apiVersion":"2014-04-01","location":"East US","tags":{"[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]":"Resource"},"properties":{"name":"[concat('CPUHigh ', parameters('hostingPlanName'))]","description":"[concat('The average CPU is high across all the instances of ', parameters('hostingPlanName'))]","isEnabled":false,"condition":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.ThresholdRuleCondition","dataSource":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.RuleMetricDataSource","resourceUri":"[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]","metricName":"CpuPercentage"},"operator":"GreaterThan","threshold":90,"windowSize":"PT15M"},"action":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.RuleEmailAction","sendToServiceOwners":true,"customEmails":[]}},"dependsOn":["[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"]},{"type":"microsoft.insights/alertrules","name":"[concat('LongHttpQueue ', parameters('hostingPlanName'))]","apiVersion":"2014-04-01","location":"East US","tags":{"[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]":"Resource"},"properties":{"name":"[concat('LongHttpQueue ', parameters('hostingPlanName'))]","description":"[concat('The HTTP queue for the instances of ', parameters('hostingPlanName'), ' has a large number of pending requests.')]","isEnabled":false,"condition":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.ThresholdRuleCondition","dataSource":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.RuleMetricDataSource","resourceUri":"[concat(resourceGroup().id, '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]","metricName":"HttpQueueLength"},"operator":"GreaterThan","threshold":100,"windowSize":"PT5M"},"action":{"odata.type":"Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.RuleEmailAction","sendToServiceOwners":true,"customEmails":[]}},"dependsOn":["[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"]},{"type":"microsoft.insights/components","name":"[parameters('siteName')]","apiVersion":"2014-04-01","location":"Central US","tags":{"[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/sites/', parameters('siteName'))]":"Resource"},"properties":{"applicationId":"[parameters('siteName')]"},"dependsOn":["[concat('Microsoft.Web/sites/', parameters('siteName'))]"]}],"outputs":{"exampleOutput":{"type":"String","value":"[concat('string','To','Concatenate')]"}}}